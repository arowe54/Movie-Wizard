{% extends "layout.html" %}

{% block title %}
    Homepage
{% endblock %}

{% block main %}
    <div class="jumbotron" style="height: 400px">
        <div class="container">
            <h1 class="midnight display-1"><i class="fa-solid fa-hat-wizard" alt="wizard hat"></i>Movie Wizard</h1>
            <p class="lead text-muted">
                Have you ever not been able to find a movie to watch?
                This website gives you the inspiration to find what you want to watch just from the click of a few buttons
            </p>
            <p>
                <!--Goes to a page where you can submit a form (check a bunch of boxes), app makes a bunch of requests, finds and returns common movies from the request (ex. using if key in x and y and z and etc..)-->
                <button class="btn btn-primary">Find a Movie</button>
                <a href="/search"> <button class="btn btn-secondary">Get a Random Movie</button> </a>
            </p>
        </div>        
    </div>

    <div class="container-fluid bg-light">
        <!--Upcoming Movies-->
        <h2>Upcoming Movies</h2>
        <!--5 movies per row-->
        <div class="row row-cols-sm-5 row-cols-2 card-group">
            {% for movie in upcoming %}
            <div class="col">
                <!--Make a card for the movie-->
                <div class="card">
                    {% if movie.primaryImage != None %}
                        <img src="{{ movie.primaryImage.url }}" class="card-img-top" alt="{{ movie.primaryImage.caption.plainText }}">
                    {% else %}
                        <img src="../static/card-image.svg" class="card-img-top" alt="Bootstrap">
                    {% endif %}
                    <div class="card-body">
                        <h5 class="card-title">{{ movie.titleText.text }}</h5>

                        <p class="card-text"><small class="text-body-secondary">
                            {% if movie.releaseDate != None %}
                                {{ movie.releaseDate.day }} / {{ movie.releaseDate.month }} / {{ movie.releaseDate.year }}
                            {% else %}
                                <p>NA</p>
                            {% endif %}
                        </small></p>

                    
                        <div class="btn-group" role="group" aria-label="Advanced movie options">
                            <!--Click button and it goes to more info about the movie-->
                            <form action="/movie" method="get" id="movie.id" >
                                <input type="hidden" name="movie_id" value="{{ movie.id }}">
                                <button type="submit" class="btn btn-outline-primary">More info</button>
                            </form>

                            <!--Update Watchlist-->
                            {% if movie.id in movies_in_watchlist %}
                                <form name="removeWatch" id="removeWatch" action="/watchlist" method="post">
                                    <input type="hidden" name="movie_id" value="{{ movie.id }}">
                                    <input type="hidden" name="action" id="action" value="remove">
                                    <button type="submit" class="btn btn-outline-primary" onclick="this.form.submit()">Remove from Watchlist</button>  
                                </form>
                            {% else %}
                                <form name="addWatch" id="addWatch" action="/watchlist" method="post">
                                    <input type="hidden" name="movie_id" value="{{ movie.id }}">
                                    <input type="hidden" name="action" id="action" value="add">
                                    <button type="submit" class="btn btn-outline-primary" onclick="this.form.submit()" {{"disabled" if not session["user_id"] }}>Add to Watchlist</button>
                                    <!--TODO: Add a popover saying "You must be logged in to Add to Watchlist"-->
                                </form>
                            {% endif %}
                            
                        </div>
                    </div>
                </div>
            </div> 

            {% endfor %}
            <!--Restart the request to hold different, random upcoming movies-->
            <label for="randomize">Get Random Upcoming Movies:</label>
            <button id="randomize">Randomize</button>             
        </div>
    </div>
    

    <!--Top 10 box office movies last weekend-->

    <!--TODO: Add a "back to top" navbar item-->


    <!-- Change the shading of this container so it is slightly darker-->
    <div class="container">
        <hr>
        <!--Show Top 10 movies in the box office last weekend-->
        <h2>Top Movies Last Weekend</h2>
        <table class="table">
            <thead class="table-dark">
                <tr>
                    <th scope="col">Poster</th>
                    <th scope="col">About</th>
                    <th scope="col">Release Date (D/M/Y)</th>

                </tr>
            </thead>
            <tbody>
                {% for movie in box_10 %}
                <tr>
                    
                    <td>
                        {% if movie.primaryImage != None %}
                        <figure>
                            <img src="{{ movie.primaryImage.url }}" alt="{{ movie.primaryImage.caption.plainText }}" class="img-fluid">
                            <figcaption>{{ movie.primaryImage.caption.plainText }}</figcaption>
                        </figure>
                        {% else %}
                        <p>Poster Unavailable</p>
                        {% endif %}
                    </td>
                    <td>
                        Title: {{ movie.titleText.text }} <br>
                        Short ID: {{ movie.id }} <br>
                        Long ID: {{ movie._id }}
                        <!--Click button and it goes to more info about the movie-->
                        <form action="/movie" method="get" id="movie.id" >
                            <select hidden name="movie_id" onclick="this.form.submit()">
                                <option hidden value="{{ movie.id }}" selected></option>
                            </select>
                            <button type="submit" class="btn btn-primary">More info</button>
                        </form>
                        <!--Checkbox to Update Watchlist-->
                        {% if session["user_id"] %}
                        <button class="container-fluid">
                            <h2>Add to Watchlist:</h2>
                            {% if movie.id in movies_in_watchlist %}
                                <form name="removeWatch" id="removeWatch" action="/watchlist" method="post">
                                    <input type="hidden" name="movie_id" value="{{ movie.id }}">
                                    <input type="hidden" name="action" id="action" value="remove">
                                    <input class="form-check-input" type="checkbox" onclick="this.form.submit()" checked>  
                                </form>
                            {% else %}
                                <form name="addWatch" id="addWatch" action="/watchlist" method="post">
                                    <input type="hidden" name="movie_id" value="{{ movie.id }}">
                                    <input type="hidden" name="action" id="action" value="add">
                                    <input class="form-check-input" type="checkbox" onclick="this.form.submit()">
                                </form>
                            {% endif %}
                        </button>
                        {% endif %}
                    </td>
                        
                    <td>
                        {% if movie.releaseDate != None %}
                            {{ movie.releaseDate.day }} / {{ movie.releaseDate.month }} / {{ movie.releaseDate.year }}
                        {% else %}
                            <p>NA</p>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

    </div>
    

{% endblock %}
<!--TODO: Run all html files through an html validator before submitting-->